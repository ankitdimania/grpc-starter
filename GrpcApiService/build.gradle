version '0.0.1-SNAPSHOT'

buildscript {
    dependencies {
        classpath 'net.ltgt.gradle:gradle-apt-plugin:0.6'
    }
}

apply plugin: 'net.ltgt.apt'
apply plugin: 'application'
apply plugin: 'idea'

description = 'GrpcAPI: Service'

startScripts.enabled = false

dependencies {
    compile project(':grpcapi-interface')
    compile project(':GrpcApiCommons')
    compile project(':GrpcApiCore')

    // DI
    compile 'com.google.dagger:dagger:2.5' // dependency of dagger-compiler
    apt 'com.google.dagger:dagger-compiler:2.5'

    // lombok
    compileOnly 'org.projectlombok:lombok:1.16.+'
    apt 'org.projectlombok:lombok:1.16.+'

//    compile 'com.google.protobuf:protobuf-java-util:3.0.0-beta-2'
}

task mathServer(type: CreateStartScripts) {
    mainClassName = "com.grootstock.helloworld.MathServer"
    applicationName = "math-server"
    outputDir = new File(project.buildDir, 'tmp')
    classpath = jar.outputs.files + project.configurations.runtime
    defaultJvmOpts = ["-Dlog4j.configurationFile=log4j2-prod.xml"]
}

task helloWorldServer(type: CreateStartScripts) {
    mainClassName = "com.grootstock.helloworld.HelloWorldServer"
    applicationName = "hello-world-server"
    outputDir = new File(project.buildDir, 'tmp')
    classpath = jar.outputs.files + project.configurations.runtime
}

applicationDistribution.into('bin') {
    from(helloWorldServer)
    from(mathServer)
    fileMode = 0755
}
